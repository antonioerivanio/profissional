<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition template="../../WEB-INF/templates/page.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:rich="http://richfaces.org/rich">

	<ui:define name="content">
		<!-- Esta tela é composta de campos para o cadastro das solicitações de auxilio do BENEFICIARIO E SEU DEPENDENTES-->
		<!-- Após o envio dos dados, estes ficaram aguardando aprovação da área Gerência de Remuneração e Benefícios -->
		<!-- O campo do dependentes será carregado automatica se existir na tabela SRH.TB_DEPENDENTEDependentes-->
		<!-- quando o colocaborador logado escolher o seu dependente os campos para cadastro de valor e pessoa juridica será exibido [metodo chamado exibirCamposDependentes()] -->

		<!-- id=asFrmOtNome foi usado atalhos, então o id seria igual auxilioSaudeFormularioOutputTextNome  -->

		<h:outputStylesheet>
		.tabela-dados-dependentes {
			display: none
		}

	</h:outputStylesheet>

		<h:outputScript>
		function exibirCamposDependentes(){		
			$(".tabela-dados-dependentes").show();  	
		}

	</h:outputScript>

		<div class="titulo-pagina">
			<h2>Cadastro - Requerimento Auxílio-Saúde</h2>
		</div>

		<span class="label-campos-obrigarotios"><i>* Campos
				Obrigatórios</i></span>
		<br></br>

		<a4j:outputPanel ajaxRendered="true">
			<h:messages id="messages" infoClass="infoMessage"
				errorClass="errorMessage" />
		</a4j:outputPanel>

		<h:form id="form" styleClass="formularios">

			<!-- Inicio dos campos do Beneficiário -->
			<fieldset>
				<legend>Beneficiários</legend>

				<ui:fragment>

					<div class="select-box box-80">
						<label for="">Servidor *</label>
						<div class="conteiner">
							<h:selectOneMenu id="servidor" converter="entityConverter"
								value="#{auxilioSaudeFormBean.entidade.funcional}">
								<f:selectItem id="selecioneServidor" itemLabel="Selecione..." />
								<f:selectItems id="comboServidor"
									value="#{auxilioSaudeFormBean.afastamentoFormBean.servidorEnvioList}"
									var="servidor" itemValue="#{servidor}"
									itemLabel="#{servidor.nome}" />
							</h:selectOneMenu>
						</div>
					</div>

					<br></br>

					<h:commandButton actionListener="#{auxilioSaudeFormBean.consultar}"
						value="Consultar" styleClass="bt-padrao fr mg-right-10" />


					<ui:fragment id="asFrmFragDadosBeneficiario">
						<div class="input-box">
							<div class="input-box box-25">
								<label for="asFrmOtNome">Nome</label>
								<h:outputText name="asFrmOtNome"
									value="#{auxilioSaudeFormBean.entidade.funcional.nomeCompleto}" />
							</div>

							<div class="input-box box-10">
								<label for="asFrmOtMat">Matricula</label>
								<h:outputText name="asFrmOtMat"
									value="#{auxilioSaudeFormBean.entidade.funcional.matricula}"></h:outputText>
							</div>

							<div class="input-box box-25">
								<label for="asFrmOtLot">Lotação</label>
								<h:outputText name="asCadLot"
									value="#{auxilioSaudeFormBean.entidade.funcional.setor.nome}"></h:outputText>
								<br></br>
							</div>

							<div class="input-box box-10">
								<label for="asFrmOtAtivo">Servidor Ativo</label>
								<h:outputText name="asFrmOtAtivo"
									value="#{auxilioSaudeFormBean.entidade.statusFuncional}"></h:outputText>
								<br></br>
							</div>

							<div class="input-box box-15">
								<label for="asFrmOtCargo">Cargo/Função</label>
								<h:outputText name="asFrmOtCargo"
									value="#{auxilioSaudeFormBean.entidade.funcional.ocupacao.nomenclatura}"></h:outputText>
								<br></br>
							</div>

							<div class="input-box box-10">
								<label for="asDtInicio">Data Atual</label>
								<h:outputText name="asDtInicio"
									value="#{auxilioSaudeFormBean.entidade.dataInicioRequisicao}" />
							</div>
						</div>

						<div class="input-box box-20 ">
							<label for="asFrmItValorPlano">Valor Mensal R$: *</label>

							<div class="conteiner">
								<h:inputText id="asFrmItValorPlano"
									value="#{auxilioSaudeFormBean.entidade.valorGastoPlanoSaude}"
									maxlength="20" styleClass="maskSalario">
									<f:convertNumber type="currency" currencySymbol="R$"
										locale="pt_br" />
								</h:inputText>
							</div>
						</div>

						<div class="select-box box-30">
							<label for="">Nome Empresa Plano Saúde * </label>

							<div class="conteiner">
								<h:selectOneMenu id="asFrmStPjBeneficiario"
									value="#{auxilioSaudeFormBean.entidade.pessoaJuridica}"
									converter="entityConverter">
									<f:selectItem itemLabel="Selecione..." itemValue="" />
									<f:selectItems
										value="#{auxilioSaudeFormBean.comboEmpresasCadastradas}"
										var="orgaoOrigem" itemValue="#{orgaoOrigem}"
										itemLabel="#{orgaoOrigem.nomeFantasia} - #{orgaoOrigem.razaoSocial}" />
									<a4j:ajax execute="@this"></a4j:ajax>
								</h:selectOneMenu>
							</div>
						</div>

						<rich:fileUpload styleClass="fileUploadFicha"
							style="display: none; padding-rigth:10px" id="asFrmFlBenefeciario"
							fileUploadListener="#{auxilioSaudeFormBean.uploadComprovante}"
							acceptedTypes="pdf"
							ontyperejected="alerta('Somente arquivos PDF são aceitos.');"
							maxFilesQuantity="1" immediateUpload="true"
							onsizerejected="alerta('O tamanho do arquivo excedeu o limite do sistema.');">
							<!-- parametros enviado para servidor -->
							<f:attribute name="isComprovanteBeneficiario" value="true" />
							
							<a4j:ajax event="uploadcomplete" execute="@none"
								render="form:asFrmFlBenefeciario, messages" />
						</rich:fileUpload>

						<span id="asFrmBntAnexoBeneficiario"
							class="bt-upload fl mg-top-14"
							onclick="document.querySelector('.fileUploadFicha input').click()">Anexar</span>

						<!-- Exibe informações do botão anexar quando usuário passar o mouse sobre ele -->
						<rich:tooltip styleClass="tooltip" layout="block"
							target="asFrmBntAnexoBeneficiario">
							<span style="white-space: nowrap"> <strong>
									Anexar documentação comprobatória</strong>
							</span>
						</rich:tooltip>

						<h:commandButton id="asFrmBtnAdicionarBeneficiario"
							actionListener="#{auxilioSaudeFormBean.adicionarDadosBeneficiario(auxilioSaudeFormBean.entidade, true)}"
							value="Adicionar" styleClass="bt-padrao fl mg-top-14 mg-left-10"
							style="padding:10px;">
							<a4j:ajax execute="asFrmStPjBeneficiario asFrmItValorPlano"
								render="asFrmDtBeneficiario"></a4j:ajax>
						</h:commandButton>

						<div class="tabela-dados">
							<rich:dataTable id="asFrmDtBeneficiario" var="item"
								rows="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoList.size()}"
								value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoList}">
								<h:column>
									<f:facet name="header">
		                            NOME DA EMPRESA DO PLANO DE SAÚDE
		                        </f:facet>

									<h:outputText value="#{item.pessoaJuridica.nomeFantasia}" />
								</h:column>
								<h:column>
									<f:facet name="header">
		                            Valor Gasto (R$)
		                        </f:facet>

									<h:outputText value="#{item.valorGastoPlanoSaude}" />
								</h:column>
								<h:column>
									<center>
										<f:facet name="header">
		                          Anexos
		                        </f:facet>

										<h:outputLink
											actionListener="#{auxilioSaudeFormBean.adicionar}">
											<h:graphicImage url="/img/attached.png"
												style="cursor: pointer; width: 24px;height: 24px;"></h:graphicImage>
										</h:outputLink>
									</center>
								</h:column>

							</rich:dataTable>
						</div>
					</ui:fragment>
				</ui:fragment>
			</fieldset>
			<!-- fim campo Beneficiario -->


			<!-- inicios dos campos dos dependentes -->
			<fieldset>
				<legend>Dependentes</legend>

				<ui:fragment style="width: 100%; margin-bottom: 15px;">
					<div class="select-box box-100">
						<label for=""> Nome do dependente </label>

						<div class="conteiner">
							<h:selectOneMenu converter="entityConverter" id="asFrmSomNomeDep"
								disabled="#{empty auxilioSaudeFormBean.entidade.dependentesComboList}"
								onchange="exibirCamposDependentes()"
								value="#{auxilioSaudeFormBean.entidade.dependenteSelecionado}">
								<f:selectItem itemLabel="Selecione..." />
								<f:selectItems
									value="#{auxilioSaudeFormBean.entidade.dependentesComboList}"
									var="beanDep" itemValue="#{beanDep}"
									itemLabel="#{beanDep.dependente.nomeCompleto}" />
								<a4j:ajax execute="@this"></a4j:ajax>
							</h:selectOneMenu>
						</div>
					</div>
				</ui:fragment>

				<ui:fragment style="width: 100%; margin-bottom: 15px;">
					<div class="tabela-dados-dependentes">
						<div class="input-box box-20 ">
							<label for="asFrmItValorPlanoDep">Valor Mensal R$: *</label>

							<div class="conteiner">
								<h:inputText id="asFrmItValorPlanoDep"
									value="#{auxilioSaudeFormBean.entidade.valorGastoPlanoSaude}"
									maxlength="20" styleClass="maskSalario">
									<f:convertNumber type="currency" currencySymbol="R$"
										locale="pt_br" />
								</h:inputText>
							</div>
						</div>

						<div class="select-box box-30">
							<label for="">Nome Empresa Plano Saúde * </label>

							<div class="conteiner">
								<h:selectOneMenu id="asFrmSomPJDep"
									value="#{auxilioSaudeFormBean.entidade.pessoaJuridica}"
									converter="entityConverter">
									<f:selectItem itemLabel="Selecione..." itemValue="" />
									<f:selectItems
										value="#{auxilioSaudeFormBean.comboEmpresasCadastradas}"
										var="orgaoOrigem" itemValue="#{orgaoOrigem}"
										itemLabel="#{orgaoOrigem.nomeFantasia} - #{orgaoOrigem.razaoSocial}" />
									<a4j:ajax execute="@this"></a4j:ajax>
								</h:selectOneMenu>
							</div>
						</div>

						<h:panelGroup>

							<ui:fragment
								rendered="#{LoginBean.anyGranted('ROLE_FOLGA_INSERIR,ROLE_FOLGA_ALTERAR')}">
								<rich:fileUpload styleClass="fileUploadFichaDep"
									style="display: none; padding-rigth:10px" 
									fileUploadListener="#{auxilioSaudeFormBean.uploadComprovante}"
									acceptedTypes="pdf"
									ontyperejected="alerta('Somente arquivos PDF são aceitos.');"
									maxFilesQuantity="1" immediateUpload="true"
									onsizerejected="alerta('O tamanho do arquivo excedeu o limite do sistema.');">
									
									<f:attribute name="isComprovanteBeneficiario" value="false" />
									
									<a4j:ajax event="uploadcomplete" execute="@none"
										render="messages" />
								</rich:fileUpload>


								<span id="asFrmBntAnexoDep" class="bt-upload fl mg-top-14"
									onclick="document.querySelector('.fileUploadFichaDep input').click()">Anexar</span>

								<!-- Exibe informações do botão Novo quando usuário passar o mouse sobre ele -->
								<rich:tooltip styleClass="tooltip" layout="block"
									target="asFrmClAnexoDep">
									<span style="white-space: nowrap"> <strong>
											Anexar documentação comprobatória</strong>
									</span>
								</rich:tooltip>
							</ui:fragment>

							<h:commandLink styleClass="link-arquivo"
								id="asFrmBtnLinkArquivoDep" value="Clique aqui para visualizar"
								action="#{folgaFormBean.comprovanteFolga}" target="_blank"
								rendered="#{folgaFormBean.entidade.caminhoComprovante != null}" />

							<h:commandButton id="asFrmBtnSalvarDep"
								actionListener="#{auxilioSaudeFormBean.adicionarDadosBeneficiario(auxilioSaudeFormBean.entidade, false)}"
								value="Adicionar" styleClass="bt-padrao fl mg-top-14 mg-left-10"
								style="padding:10px;">
								<a4j:ajax execute="asFrmItValorPlanoDep" render="asFrmDtDep"></a4j:ajax>
							</h:commandButton>

						</h:panelGroup>
						<div class="tabela-dados">

							<rich:dataTable id="asFrmDtDep" var="item"
								rows="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoDependenteList.size()}"
								value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoDependenteList}">

								<h:column>
									<f:facet name="header">
		                            NOME DA EMPRESA DO PLANO DE SAÚDE
		                        </f:facet>

									<h:outputText value="#{item.pessoaJuridica.nomeFantasia}" />
								</h:column>

								<h:column>
									<f:facet name="header">
		                            Valor Gasto (R$)
		                        </f:facet>

									<h:outputText value="#{item.valorGastoPlanoSaude}" />
								</h:column>

								<h:column>
									<center>
										<f:facet name="header">
		                          Anexos
		                        </f:facet>
										<h:outputLink
											actionListener="#{auxilioSaudeFormBean.adicionar}">
											<h:graphicImage url="/img/attached.png"
												style="cursor: pointer; width: 24px;height: 24px;"></h:graphicImage>
										</h:outputLink>
									</center>
								</h:column>

							</rich:dataTable>
						</div>
					</div>
				</ui:fragment>
			</fieldset>
			<!-- Fim campos Dependentes -->


			<!-- Campo obrigatório apenas para área gestora -->
			<div class="textarea-box box-100">
				<label for="">Observações da área</label>
				<div class="conteiner">
					<h:inputTextarea id="asFrmIttObs"
						value="#{auxilioSaudeFormBean.entidade.observacao}"
						onkeyup="this.value = this.value.substring(0, 254);" />
				</div>
			</div>

			<fieldset>
				<legend>
					<strong> <span style="color: #024ffb;important!">DECLARAÇÃO</span></strong>
				</legend>

				<div class="conteiner">
					<p>
						<h:outputLabel value="#{auxilioSaudeFormBean.entidade.declaracao}"></h:outputLabel>
					</p>
				</div>

				<div class="conteiner" style="padding: 15px; font-size: 15px">
					<div class="radio-box box-25">
						<h:selectBooleanCheckbox required="true"
							requiredMessage="Campo Obrigatório Concordo" id="asFrmSbcxAcordo"
							value="#{auxilioSaudeFormBean.entidade.flAfirmaSerVerdadeiraInformacao}" />
						Concordo
					</div>
				</div>
			</fieldset>

			<div class="bt-conteiner">
				<h:commandButton id="asFrmBtnSalvar"
					action="#{auxilioSaudeFormBean.salvar()}" value="Salvar"
					styleClass="bt-padrao fr mg-right-10"
					onclick="exibirCamposDependentes()" />

				<a href="/srh/paginas/cadastros/auxilioSaudeList.faces"
					class="bt-voltar fr mg-right-10 mg-bottom-10">Voltar</a>
			</div>
		</h:form>

	</ui:define>

</ui:composition>
