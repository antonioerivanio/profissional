<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition template="../../WEB-INF/templates/page.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:t="http://myfaces.apache.org/tomahawk"
	xmlns:rich="http://richfaces.org/rich">


	<ui:define name="content">
		<!-- Manter o scroll parado após reloading da paginas-->
		<h:outputScript>
			function storePagePosition() {
			  var page_y = window.pageYOffset;
			  localStorage.setItem("page_y", page_y);
			}

			window.addEventListener("scroll", storePagePosition);
			var currentPageY;

			try {
			  currentPageY = localStorage.getItem("page_y");
			
			  if (currentPageY === undefined) {
			    localStorage.setItem("page_y") = 0;
			  }
			
			  window.scrollTo( 0, currentPageY );
			} catch (e) {
			    // no localStorage available
			}
		</h:outputScript>

		<!-- Esta tela é composta de campos para o cadastro das solicitações de auxilio do BENEFICIARIO E SEU DEPENDENTES-->
		<!-- Após o envio dos dados, estes ficaram aguardando aprovação da área Gerência de Remuneração e Benefícios -->
		<!-- O campo do dependentes será carregado automatica se existir na tabela SRH.TB_DEPENDENTEDependentes-->
		<!-- quando o colocaborador logado escolher o seu dependente os campos para cadastro de valor e pessoa juridica será exibido [metodo chamado exibirCamposDependentes()] -->

		<!-- id=nomeBenef foi usado atalhos, então o id seria igual auxilioSaudeFormularioOutputTextNome  -->


		<div class="titulo-pagina">
			<h2>Cadastro - Requerimento Auxílio-Saúde</h2>
		</div>

		<h:panelGroup rendered="#{!auxilioSaudeFormBean.isEdicao}">
			<fieldset
				style="background-color: #fffbce; padding: 0px 9px 24px 31px">
				<legend>
					<p style="color: red">Aviso do prazo de solicitação:</p>
				</legend>
				<br />
				<h:outputText
					style="padding-bottom:10px; font-style: italic; font: 1.00625em Verdana,sans-serif; color: #454545; font-size:small"
					value="#{auxilioSaudeFormBean.entidade.aviso}"></h:outputText>
			</fieldset>
		</h:panelGroup>


		<span class="label-campos-obrigarotios"><i>* Campos
				Obrigatórios</i></span>
		<br></br>

		<a4j:outputPanel ajaxRendered="true">
			<h:messages id="messages" infoClass="infoMessage"
				errorClass="errorMessage" />
		</a4j:outputPanel>

		<h:form id="form" styleClass="formularios"
			enctype="multipart/form-data" prependId="true">

			<!-- Inicio dos campos do Beneficiário -->
			<fieldset>
				<legend>Beneficiários</legend>

				<div class="select-box box-80">
					<label for="">Servidor *</label>
					<div class="conteiner">
						<h:selectOneMenu id="servidor" converter="entityConverter"
							value="#{auxilioSaudeFormBean.entidade.funcional}"
							disabled="#{!auxilioSaudeFormBean.isAnalista()}">
							<f:selectItem id="selecioneServidor" itemLabel="Selecione..." />
							<f:selectItems id="comboServidor"
								value="#{auxilioSaudeFormBean.afastamentoFormBean.servidorEnvioList}"
								var="servidor" itemValue="#{servidor}"
								itemLabel="#{servidor.nome}" />
							<a4j:ajax execute="@this"></a4j:ajax>
						</h:selectOneMenu>
					</div>
				</div>

				<br></br>

				<h:commandButton rendered="#{auxilioSaudeFormBean.isAnalista()}"
					actionListener="#{auxilioSaudeFormBean.consultar}"
					value="Consultar" styleClass="bt-padrao fr mg-right-10"
					immediate="true" onclick="#{rich:component('dependentes')}.show()">
					<a4j:ajax render="dadosBeneficiario dependentes panelGroupResumo"></a4j:ajax>
				</h:commandButton>

				<h:panelGroup class="input-box" id="dadosBeneficiario">
					<div class="input-box box-20">
						<label for="nomeBenef">Nome</label>
						<h:outputText styleClass="textSmall" name="nomeBenef"
							value="#{auxilioSaudeFormBean.entidade.funcional.nomeCompleto}" />
					</div>

					<div class="input-box box-10">
						<label for="matricula">Matricula</label>
						<h:outputText styleClass="textSmall" name="matricula"
							value="#{auxilioSaudeFormBean.entidade.funcional.matricula}"></h:outputText>
					</div>

					<div class="input-box box-10">
						<label for="asFrmOtLot">Lotação</label>
						<h:outputText styleClass="textSmall" name="lotacao"
							value="#{auxilioSaudeFormBean.entidade.funcional.setor.nome}"></h:outputText>
						<br></br>
					</div>

					<div class="input-box box-10">
						<label for="statusFuncional">Servidor Ativo</label>
						<h:outputText styleClass="textSmall" name="statusFuncional"
							value="#{auxilioSaudeFormBean.entidade.statusFuncional}"></h:outputText>
						<br></br>
					</div>

					<div class="input-box box-15">
						<label for="cargo">Cargo/Função</label>
						<h:outputText styleClass="textSmall" name="cargo"
							value="#{auxilioSaudeFormBean.entidade.funcional.ocupacao.nomenclatura}"></h:outputText>
						<br></br>
					</div>

					<div class="input-box box-15">
						<label for="dataInicio">Data da Solicitação</label>
						<h:outputText styleClass="textSmall" name="dataInicio"
							value="#{auxilioSaudeFormBean.entidade.dataInicioRequisicao}" />
					</div>

					<div class="input-box box-15">
						<label for="dataInicio">Data da Aprovação</label>
						<h:outputText styleClass="textSmall" name="dataInicio"
							value="#{auxilioSaudeFormBean.entidade.dataInicioRequisicao}" />
					</div>
				</h:panelGroup>

				<div class="input-box box-20">
					<label for="valorPlanoBenef">Valor Mensal R$: *</label>

					<div class="conteiner">
						<h:inputText id="valorPlanoBenef"
							value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoItem.valorGastoPlanoSaude}"
							maxlength="20" styleClass="maskSalario">
							<f:convertNumber type="currency" currencySymbol="R$"
								locale="pt_br" />
						</h:inputText>
					</div>

				</div>

				<div class="select-box box-70">
					<label for="">Nome Empresa Plano Saúde * </label>

					<div class="conteiner">
						<h:selectOneMenu id="selectNomeEmpresaBenef"
							value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoItem.pessoaJuridica}"
							converter="entityConverter">
							<f:selectItem itemLabel="Selecione..." itemValue="" />
							<f:selectItems
								value="#{auxilioSaudeFormBean.comboEmpresasCadastradas}"
								var="orgaoOrigem" itemValue="#{orgaoOrigem}"
								itemLabel="#{orgaoOrigem.nomeFantasia} - #{orgaoOrigem.razaoSocial}" />
						</h:selectOneMenu>
					</div>
				</div>

				<div class="select-box box-80">
					<rich:fileUpload id="upload" addLabel="Anexar Comprovante"
						doneLabel="Concluído" clearLabel="Excluir"
						clearAllLabel="Excluir tudo"
						style="height: 120px!!important; width:100%"
						fileUploadListener="#{auxilioSaudeFormBean.uploadComprovanteBeneficario}"
						acceptedTypes=".pdf" immediateUpload="true"
						ontyperejected="alert('Somente arquivos PDF são aceitos.');"
						maxFilesQuantity="1">
						<a4j:ajax event="uploadcomplete" execute="@none" />
					</rich:fileUpload>
				</div>

				<h:commandButton
					action="#{auxilioSaudeFormBean.adicionar(auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoItem, true)}"
					value="Adicionar" styleClass="bt-padrao fl mg-left-10"
					style="padding:10px;" onclick="window.location.reload(false)">
					<a4j:ajax execute="valorPlanoBenef selectNomeEmpresaBenef"
						render="upload, valorPlanoBenef, selectNomeEmpresaBenef, asCadFrmDtBeneficiario, panelGroupResumo}" />
				</h:commandButton>

				<div class="tabela-dados">
					<rich:dataTable id="asCadFrmDtBeneficiario" var="beanBenef"
						rows="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoBeneficiarioItemList.size()}"
						value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoBeneficiarioItemList}">

						<h:column>
							<f:facet name="header">
		                            NOME DA EMPRESA DO PLANO DE SAÚDE
		                        </f:facet>

							<h:outputText value="#{beanBenef.pessoaJuridica.nomeFantasia}" />
						</h:column>
						<h:column>
							<f:facet name="header">
		                            Valor Gasto (R$)
		                        </f:facet>

							<h:outputText value="#{beanBenef.valorGastoPlanoSaude}">
								<f:convertNumber type="currency" currencySymbol="R$"
									locale="pt_br" />
							</h:outputText>
						</h:column>
						<h:column>
							<center>
								<f:facet name="header">
		                          Anexos
		                        </f:facet>

								<ui:repeat var="anexo"
									value="#{beanBenef.auxilioSaudeRequisicaoDocumentoBeneficiarioList}">
									<h:commandLink immediate="true"
										actionListener="#{auxilioSaudeFormBean.visualizarAnexoBeneficiario(beanBenef)}"
										style="padding:5px; color:blue;" value="#{anexo.nomeArquivo}"
										target="_blank">
									</h:commandLink>
									<br />
								</ui:repeat>
							</center>
						</h:column>

						<h:column>
							<center>
								<f:facet name="header">
		                          Ação
		                        </f:facet>
								<h:commandLink immediate="true"
									actionListener="#{auxilioSaudeFormBean.deletar(beanBenef)}"
									style="padding-left:10px">
									<a4j:ajax render="asCadFrmDtBeneficiario panelGroupResumo"></a4j:ajax>
									<h:graphicImage value="/img/ico-delete.png"></h:graphicImage>
								</h:commandLink>
							</center>
						</h:column>

					</rich:dataTable>
				</div>
			</fieldset>
			<!-- fim campo Beneficiario -->


			<h:panelGroup id="dependentes">
				<ui:fragment
					rendered="#{not empty auxilioSaudeFormBean.entidade.dependentesComboList}">
					<!-- inicios dos campos dos dependentes -->
					<fieldset>
						<legend>Dependentes</legend>

						<div class="select-box box-100">
							<label for=""> Nome do dependente </label>

							<div class="conteiner">
								<h:selectOneMenu converter="entityConverter"
									id="selectNomeDepente"
									value="#{auxilioSaudeFormBean.entidade.dependenteSelecionado}">
									<f:selectItem itemLabel="Selecione..." />
									<f:selectItems
										value="#{auxilioSaudeFormBean.entidade.dependentesComboList}"
										var="beanDep" itemValue="#{beanDep}"
										itemLabel="#{beanDep.dependente.nomeCompleto}" />
									<f:ajax execute="@this"></f:ajax>
								</h:selectOneMenu>
							</div>
						</div>

						<div class="input-box box-20 ">
							<label for="valorPlanoDep">Valor Mensal R$: *</label>

							<div class="conteiner">
								<h:inputText id="valorPlanoDep"
									value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoItem.valorGastoPlanoSaude}"
									maxlength="20" styleClass="maskSalario">
									<f:convertNumber type="currency" currencySymbol="R$"
										locale="pt_br" />
								</h:inputText>
							</div>
						</div>

						<div class="select-box box-70">
							<label for="nomeEmpresaDep">Nome Empresa Plano Saúde * </label>

							<div class="conteiner">
								<h:selectOneMenu id="nomeEmpresaDep"
									value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoItem.pessoaJuridica}"
									converter="entityConverter">
									<f:selectItem itemLabel="Selecione..." itemValue="" />
									<f:selectItems
										value="#{auxilioSaudeFormBean.comboEmpresasCadastradas}"
										var="orgaoOrigem" itemValue="#{orgaoOrigem}"
										itemLabel="#{orgaoOrigem.nomeFantasia} - #{orgaoOrigem.razaoSocial}" />
								</h:selectOneMenu>
							</div>
						</div>

						<ui:fragment>
							<div class="select-box box-80">
								<rich:fileUpload id="upload2" addLabel="Anexar Comprovante"
									doneLabel="Concluido" clearLabel="Excluir"
									clearAllControlLabel=""
									style="height: 120px!important; width:100%"
									fileUploadListener="#{auxilioSaudeFormBean.uploadComprovanteDependente}"
									acceptedTypes=".pdf" immediateUpload="true"
									ontyperejected="alert('Somente arquivos PDF são aceitos.');"
									maxFilesQuantity="1">

									<a4j:ajax event="uploadcomplete" execute="@none" />
								</rich:fileUpload>
							</div>
						</ui:fragment>


						<h:commandButton id="btnSalvarDep"
							actionListener="#{auxilioSaudeFormBean.adicionar(auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoItem, false)}"
							value="Adicionar" styleClass="bt-padrao fl mg-left-10"
							style="padding:10px;">
							<a4j:ajax execute="valorPlanoDep nomeEmpresaDep"
								render="upload2, messages, valorPlanoDep, nomeEmpresaDep, selectNomeDepente, panelGroupResumo, panelGroupDependente,"></a4j:ajax>
						</h:commandButton>

						<div class="tabela-dados">
							<h:panelGroup id="panelGroupDependente">
								<rich:dataTable id="asFrmDtDep" var="beanDep"
									rows="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoDependenteList.size()}"
									value="#{auxilioSaudeFormBean.entidade.auxilioSaudeRequisicaoDependenteList}">

									<h:column>
										<f:facet name="header">
		                            NOME DO DEPENDENTE
		                        </f:facet>
										<h:outputText
											value="#{beanDep.dependente.dependente.nomeCompleto}" />
									</h:column>

									<h:column>
										<f:facet name="header">
		                            NOME DA EMPRESA DO PLANO DE SAÚDE
		                        </f:facet>

										<h:outputText value="#{beanDep.pessoaJuridica.nomeFantasia}" />
									</h:column>

									<h:column>
										<f:facet name="header">
		                           Valor Mensal (R$)
		                        </f:facet>

										<h:outputText value="#{beanDep.valorGastoPlanoSaude}">
											<f:convertNumber type="currency" currencySymbol="R$"
												locale="pt_br" />
										</h:outputText>
									</h:column>

									<h:column>
										<center>
											<f:facet name="header">
		                          Anexos
		                        </f:facet>
											<ui:repeat var="anexo"
												value="#{beanDep.auxilioSaudeRequisicaoDocumentoList}">
												<h:commandLink value="#{anexo.nomeArquivo}"
													style="color:blue" immediate="true"
													actionListener="#{auxilioSaudeFormBean.visualizarAnexoDependente(beanDep)}"
													target="_blank" />
												<br />
											</ui:repeat>
										</center>
									</h:column>

									<h:column>
										<center>
											<f:facet name="header">
		                          Ação
		                        </f:facet>
											<h:commandLink
												actionListener="#{auxilioSaudeFormBean.deletarDependente(beanDep)}"
												style="padding-left:10px">
												<h:graphicImage value="/img/ico-delete.png"></h:graphicImage>
												<a4j:ajax
													render="panelGroupDependente asFrmDtDep panelGroupResumo"></a4j:ajax>
											</h:commandLink>
										</center>
									</h:column>

								</rich:dataTable>
							</h:panelGroup>
						</div>
					</fieldset>
				</ui:fragment>
			</h:panelGroup>
			<!-- Fim campos Dependentes -->

			<h:panelGroup rendered="#{auxilioSaudeFormBean.isAnalista()}">
				<!-- Campo obrigatório apenas para área gestora -->
				<div class="textarea-box box-100">
					<label for="">Observações da área</label>
					<div class="conteiner">
						<h:inputTextarea id="asFrmIttObs"
							disabled="#{not auxilioSaudeFormBean.isAnalista()}"
							value="#{auxilioSaudeFormBean.entidade.observacao}" />
					</div>
				</div>
			</h:panelGroup>

			<fieldset>
				<legend>
					<strong> <span style="color: #024ffb;important!">DECLARAÇÃO</span></strong>
				</legend>

				<div class="conteiner">
					<p>
						<h:outputLabel value="#{auxilioSaudeFormBean.entidade.declaracao}"></h:outputLabel>
					</p>
				</div>

				<div class="conteiner" style="padding: 15px; font-size: 15px">
					<div class="radio-box box-25">
						<h:selectBooleanCheckbox required="true" id="asFrmSbcxAcordo"
							value="#{auxilioSaudeFormBean.entidade.flAfirmaSerVerdadeiraInformacao}" />
						Concordo
					</div>
					<rich:message for="asFrmSbcxAcordo" ajaxRendered="true" />
				</div>
			</fieldset>

			<a4j:region id="panelGroupResumo"
				rendered="#{auxilioSaudeFormBean.entidade.statusAprovacao ne null}"
				>
				<fieldset>
					<legend>
						<strong> <span style="color: #024ffb;important!">RESUMO</span></strong>
					</legend>
					<div style="display: flex; with: 100%;">
						<div style="width: 50%">
							<div class="conteiner" style="padding: 5px">
								<p>
									<strong>Valor total solicitado: </strong>
									<h:outputText id="valorTotalSolicitado"
										value="#{auxilioSaudeFormBean.entidade.valorTotalSolicitado}">
										<f:convertNumber type="currency" currencySymbol="R$" />
									</h:outputText>
								</p>
							</div>
							<div class="conteiner" style="padding: 5px">
								<p>
									<strong>Valor a ser restituído: </strong>
									<h:outputText id="valorRestituido"
										value="#{auxilioSaudeFormBean.entidade.valorMaximoAserRestituido}">
										<f:convertNumber type="currency" currencySymbol="R$" />
									</h:outputText>
								</p>
							</div>

							<div class="conteiner" style="padding: 5px">
								<p>
									<strong>Status: </strong>
									<h:outputText
										value="#{auxilioSaudeFormBean.entidade.statusAprovacao}"
										styleClass="cel-25" />
								</p>
							</div>
						</div>

						<div class="tabela-dados"
							style="padding-left: 15px; margin-left: 10px;">
							<h5>#{auxilioSaudeFormBean.titulo}</h5>
							<rich:dataTable id="asCadFrmDtTabelBase" var="beanBase"
								rows="#{auxilioSaudeFormBean.entidade.auxilioSaudeBaseCalculo.auxilioSaudeBaseCalculos.size()}"
								value="#{auxilioSaudeFormBean.entidade.auxilioSaudeBaseCalculo.auxilioSaudeBaseCalculos}"
								style="text-align: center; ">

								<h:column>
									<f:facet name="header">
										<h:outputText value="#{auxilioSaudeFormBean.nomeColuna[0]}" />

									</f:facet>
									<h:outputText value="#{beanBase.intervaloIdade}" />
								</h:column>
								<h:column>
									<f:facet name="header">
										<h:outputText value="#{auxilioSaudeFormBean.nomeColuna[1]}" />
									</f:facet>
									<h:outputText
										value="#{beanBase.baseCalculoValorRestituido.percentual}" />
								</h:column>
								<h:column>
									<f:facet name="header">
										<h:outputText value="#{auxilioSaudeFormBean.nomeColuna[2]}" />
									</f:facet>
									<h:outputText
										value="#{beanBase.baseCalculoValorRestituido.valor}">
										<f:convertNumber type="currency" currencySymbol="R$"
											locale="pt_br" />
									</h:outputText>
								</h:column>
							</rich:dataTable>
						</div>
					</div>
				</fieldset>
			</a4j:region>

			<div class="bt-conteiner">
				<h:commandButton id="btnSalvar"
					rendered="#{auxilioSaudeFormBean.validarExibicaoBotaoSalvar()}"
					action="#{auxilioSaudeFormBean.salvar}" value="Salvar"
					styleClass="bt-padrao fr mg-right-10" />

				<h:commandLink id="btnIndeferir"
					rendered="#{auxilioSaudeFormBean.validarExibicaoBotaoDeferirEIndeferir()}"
					action="#{auxilioSaudeFormBean.deferir(false)}"
					styleClass="bt-padrao fr mg-right-10" value="INDEFERIR"
					style="background: #081e5c;" />

				<h:commandLink id="btnDeferir"
					rendered="#{auxilioSaudeFormBean.validarExibicaoBotaoDeferirEIndeferir()}"
					action="#{auxilioSaudeFormBean.deferir(true)}"
					styleClass="bt-padrao fr mg-right-10" value="DEFERIR">
				</h:commandLink>

				<h:commandButton action="#{auxilioSaudeFormBean.voltar}"
					immediate="true" value="Voltar"
					styleClass="bt-padrao fr mg-right-10" />
			</div>
		</h:form>

	</ui:define>

</ui:composition>
